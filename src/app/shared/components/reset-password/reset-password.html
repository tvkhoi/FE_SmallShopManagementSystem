<div class="reset-password-container">
  <div class="reset-password-card">
    <form nz-form [formGroup]="formGroup" class="reset-password-form" (ngSubmit)="resetPassword()">
      <div class="reset-password-avatar">
        <img src="https://cdn-icons-png.flaticon.com/512/2910/2910768.png" alt="reset-password" class="user-image">
      </div>

      <h2 class="text-center">Đặt lại mật khẩu</h2>
      <p class="text-center note">
        Nhập mã xác thực và mật khẩu mới của bạn.
      </p>

      <!-- Input mã code -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzFor="code" [nzRequired]="true">Mã xác thực</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="errorTpl">
          <input nz-input id="code" type="text" maxlength="6" minlength="6" placeholder="Nhập mã xác thực"
            formControlName="code" />
          <ng-template #errorTpl let-control>
            <ng-container *ngIf="control.hasError('required')">Vui lòng nhập mã xác thực!</ng-container>
            <ng-container *ngIf="control.hasError('pattern') || control.hasError('invalidCode')">
              Mã xác thực phải có đúng 6 chữ số!
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>

      <!-- Input mật khẩu mới -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzFor="newPassword" [nzRequired]="true">Mật khẩu mới</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="errorTplPassword">
          <div class="password-input">
            <input nz-input id="newPassword" [type]="showNewPassword ? 'text' : 'password'"
              placeholder="Nhập mật khẩu mới" formControlName="newPassword" />
            <button type="button" class="eye-icon" (click)="toggleNewPassword()" aria-label="Ẩn/Hiện mật khẩu mới">
              <i nz-icon [nzType]="showNewPassword ? 'eye-invisible' : 'eye'" nzTheme="outline"></i>
            </button>
            <ng-template #errorTplPassword let-control>
              <ng-container *ngIf="control.hasError('required')">
                Vui lòng nhập mật khẩu mới!
              </ng-container>
              <ng-container *ngIf="pendingRules.length > 0">
                <ul>
                  <li *ngFor="let rule of pendingRules">{{ rule }}</li>
                </ul>
              </ng-container>
              <ng-container *ngIf="control.hasError('whitespace')">
                Mật khẩu mới không được chứa khoảng trắng!
              </ng-container>
            </ng-template>
          </div>
        </nz-form-control>
      </nz-form-item>

      <!-- Input xác nhận mật khẩu -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzFor="confirmPassword" [nzRequired]="true">Xác nhận mật khẩu</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="errorTplConfirmPassword">
          <div class="password-input">
            <input nz-input id="confirmPassword" [type]="showConfirmPassword ? 'text' : 'password'"
              placeholder="Xác nhận mật khẩu" formControlName="confirmPassword" />
            <button type="button" class="eye-icon" (click)="toggleConfirmPassword()"
              aria-label="Ẩn/Hiện xác nhận mật khẩu">
              <i nz-icon [nzType]="showConfirmPassword ? 'eye-invisible' : 'eye'" nzTheme="outline"></i>
            </button>
            <ng-template #errorTplConfirmPassword let-control>
              <ng-container *ngIf="control.hasError('required')">
                Vui lòng xác nhận mật khẩu!
              </ng-container>
              <ng-container *ngIf="control.hasError('mismatch')">
                Mật khẩu xác nhận không khớp!
              </ng-container>
              <ng-container *ngIf="control.hasError('whitespace')">
                Mật khẩu xác nhận không được chứa khoảng trắng!
              </ng-container>
            </ng-template>
          </div>
        </nz-form-control>
      </nz-form-item>

      <!-- Nút submit -->
      <div class="text-center">
        <app-button type="primary" size="large" class="reset-password-btn" [fullWidth]="true" style="text-align: center !important;"
          [disabled]="formGroup.invalid || isLoading">
          Đặt lại mật khẩu
        </app-button>
      </div>

      <div class="back-login">
        Nhớ mật khẩu?
        <a [routerLink]="['/login']">Đăng nhập</a>.
      </div>
    </form>
  </div>
</div>