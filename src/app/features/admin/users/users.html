<div class="users-container">
    <div class="users-header">
        <h2>Người dùng</h2>
        <div class="user-header__actions">
            <button nz-button nzType="primary" (click)="showModal()">Thêm người dùng</button>
        </div>
    </div>

    <!-- Modal gán quyền cho User -->
    <nz-modal [(nzVisible)]="isVisible" nzTitle="Gán quyền cho người dùng" (nzOnCancel)="handleCancel()"
        [nzOkLoading]="isConfirmLoading" [nzFooter]="modalFooter">
        <div *nzModalContent>
            <form nz-form>
                <nz-form-item>
                    <nz-form-label [nzRequired]="true" nzFor="userId">Mã người dùng</nz-form-label>
                    <nz-form-control [nzErrorTip]="'Vui lòng nhập mã người dùng hợp lệ'">
                        <input nz-input id="userId" [(ngModel)]="userId" name="userId" required
                            placeholder="Nhập mã người dùng" type="number" />
                    </nz-form-control>
                </nz-form-item>
            </form>
        </div>
    </nz-modal>

    <app-assign-permission-modal [visible]="isAssignVisible" [user]="selectedUser"
            [groupedPermissions]="groupedPermissions" (cancel)="handleAssignCancel()"
            (save)="handleAssignOk($event)"></app-assign-permission-modal>

    <ng-template #modalFooter>
        <button nz-button nzType="default" (click)="handleCancel()">Hủy</button>
        <button nz-button nzType="primary" (click)="handleOk()" [nzLoading]="isConfirmLoading">Lưu</button>
    </ng-template>

    <div class="search-bar">
        <nz-input-group [nzSuffix]="suffixIcon">
            <input type="text" nz-input placeholder="Tìm kiếm" [(ngModel)]="searchQuery"
                (ngModelChange)="filterUsers()" />
        </nz-input-group>
        <ng-template #suffixIcon><i nz-icon nzType="search"></i></ng-template>
    </div>

    <nz-table #userTable [nzData]="users" [nzFrontPagination]="false" class="user-table">
        <thead>
            <tr>
                <th nzWidth="16.6%" data-label="Hành động">HÀNH ĐỘNG</th>
                <th nzWidth="16.6%" data-label="Tên người dùng">TÊN NGƯỜI DÙNG</th>
                <th nzWidth="16.6%" data-label="Địa chỉ email">ĐỊA CHỈ EMAIL</th>
                <th nzWidth="16.6%" data-label="Hành động">HÀNH ĐỘNG</th>
                <th nzWidth="16.6%" data-label="Tên người dùng">TÊN NGƯỜI DÙNG</th>
                <th nzWidth="16.6%" data-label="Địa chỉ email">ĐỊA CHỈ EMAIL</th>

            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let user of userTable.data">
                <td data-label="Hành động">
                    <a class="action-dropdown" nz-dropdown [nzDropdownMenu]="menu">
                        <nz-icon nzType="setting" nzTheme="outline" style="font-size: 16px; padding-right: 5px;" />Hành
                        động
                    </a>
                    <nz-dropdown-menu #menu="nzDropdownMenu">
                        <ul nz-menu>
                            <li nz-menu-item><button nz-button nzType="link" (click)="editUser(user)">Xem chi
                                    tiết</button></li>
                            <li nz-menu-item><button nz-button nzType="link" (click)="editUser(user)">Sửa</button></li>
                            <li nz-menu-item><button nz-button nzType="link" (click)="showAssignModal(user)">Gán quyền</button>
                            </li>
                            <li nz-menu-item><button nz-button nzType="link" (click)="deleteUser(user)">Xóa</button>
                            </li>
                        </ul>
                    </nz-dropdown-menu>
                </td>
                <td data-label="Tên người dùng">{{ user.username }}</td>
                <td data-label="Địa chỉ email">{{ user.email }}</td>
                <td data-label="Địa chỉ email">{{ user.email }}</td>
                <td data-label="Địa chỉ email">{{ user.email }}</td>
                <td data-label="Địa chỉ email">{{ user.email }}</td>
            </tr>
        </tbody>
    </nz-table>

    <app-pagination [total]="totalItems" [pageSize]="pageSize" [pageIndex]="currentPage"
        (pageChange)="onPageChange($event)"></app-pagination>

</div>