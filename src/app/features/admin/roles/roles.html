<div class="roles-container">
    <div class="roles-header">
        <nz-row>
            <nz-col nzSpan="12">
                <h2>Roles</h2>
            </nz-col>
            <nz-col nzSpan="12" style="text-align: right;">
                <button nz-button nzType="primary" (click)="showModal()">New Role</button>
            </nz-col>
        </nz-row>

        <!-- Modal thêm Role -->
        <nz-modal [(nzVisible)]="isVisible" nzTitle="New Role" (nzOnCancel)="handleCancel()"
            [nzOkLoading]="isConfirmLoading" [nzFooter]="modalFooter">
            <div *nzModalContent>
                <!-- Form tạo role -->
                <form nz-form>
                    <!-- Role Name Input -->
                    <nz-form-item>
                        <nz-form-label [nzRequired]="true" nzFor="roleName">Role Name</nz-form-label>
                        <nz-form-control [nzErrorTip]="'Tên vai trò là bắt buộc'" [nzValidateStatus]="roleNameInput">
                            <input nz-input id="roleName" [(ngModel)]="roleName" name="roleName"
                                #roleNameInput="ngModel" required placeholder="Enter role name" />
                        </nz-form-control>
                    </nz-form-item>

                    <!-- Permissions Tree -->
                    <h4>Permissions</h4>
                    <nz-form-item>
                        <nz-form-control [nzErrorTip]="'Vui lòng chọn ít nhất một quyền'" [nzValidateStatus]="permissionsCtrl">
                            <nz-tree [nzData]="treeData" nzCheckable (nzCheckboxChange)="onCheck($event)">
                            </nz-tree>

                            <!-- Hidden input để gom validation -->
                            <input type="hidden" [ngModel]="selectedPermissions.length > 0 ? 'valid' : ''"
                                name="permissionsCtrl" #permissionsCtrl="ngModel" required />
                        </nz-form-control>
                    </nz-form-item>
                </form>
            </div>
        </nz-modal>

        <!-- Footer Template -->
        <ng-template #modalFooter>
            <button nz-button nzType="default" (click)="handleCancel()">Cancel</button>
            <button nz-button nzType="primary" (click)="handleOk()" [nzLoading]="isConfirmLoading">
                Save
            </button>
        </ng-template>
    </div>

    <!-- Search box -->
    <div class="roles-search">
        <input nz-input placeholder="Search roles..." [(ngModel)]="searchQuery" (ngModelChange)="filterRoles()" />
        <button nz-button nzType="default">Search</button>
    </div>

    <!-- Table roles -->
    <nz-table #roleTable [nzData]="pagedRoles" [nzFrontPagination]="false">
        <thead>
            <tr>
                <th nzWidth="15%" data-label="Actions">ACTIONS</th>
                <th nzWidth="60%" data-label="Role Name">ROLE NAME</th>
                <th nzWidth="25%" data-label="User Count">USER COUNT</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let role of pagedRoles">
                <td data-label="Actions">
                    <a class="action-dropdown" nz-dropdown [nzDropdownMenu]="menu"><nz-icon nzType="setting"
                            nzTheme="outline" style="font-size: 16px; padding-right: 5px;" />Action</a>
                    <nz-dropdown-menu #menu="nzDropdownMenu">
                        <ul nz-menu>
                            <li nz-menu-item><button nz-button nzType="link" (click)="editRole(role)">Edit</button></li>
                            <li nz-menu-item><button nz-button nzType="link" (click)="deleteRole(role)">Delete</button>
                            </li>
                        </ul>
                    </nz-dropdown-menu>
                </td>
                <td data-label="Role Name">{{ role.name }}</td>
                <td data-label="User Count">{{ role.userCount }}</td>
            </tr>
        </tbody>
    </nz-table>

    <!-- Pagination -->
    <div class="pagination-container">
        <span>Total: {{ totalItems }}</span>
        <nz-pagination [nzTotal]="totalItems" [(nzPageIndex)]="currentPage" [nzPageSize]="pageSize"
            (nzPageIndexChange)="onPageChange($event)" nzShowSizeChanger="false"></nz-pagination>
    </div>
</div>