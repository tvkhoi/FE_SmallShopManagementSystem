<div class="roles-container">
  <!-- Header -->
  <div class="roles-header">
    <nz-row>
      <nz-col nzSpan="12">
        <h2>Vai trò</h2>
      </nz-col>
      <nz-col nzSpan="12" style="text-align: right;">
        <app-button nz-button nzType="primary" size="large" (click)="showCreateModal()">Tạo vai trò</app-button>
      </nz-col>
    </nz-row>

    <!-- Modal Tạo / Sửa vai trò -->
    <nz-modal [(nzVisible)]="isCreateVisible" nzTitle="{{ selectedRole ? 'Sửa vai trò' : 'Tạo vai trò' }}"
      (nzOnCancel)="handleCreateCancel()" [nzOkLoading]="isConfirmLoading" [nzFooter]="createFooter"
      nzClassName="custom-role-modal">
      <div *nzModalContent>
        <form #createRoleForm="ngForm">
          <nz-form-item>
            <nz-form-label [nzRequired]="true" nzFor="roleName">Tên vai trò</nz-form-label>
            <nz-form-control [nzErrorTip]="'Tên vai trò là bắt buộc và không được trùng lặp.'">
              <input nz-input id="roleName" name="roleName" [(ngModel)]="roleName" #roleNameInput="ngModel" required
                placeholder="Nhập tên vai trò" [ngClass]="{'input-error': roleNameExists}"
                (ngModelChange)="onRoleNameChange($event)" />
            </nz-form-control>
          </nz-form-item>
        </form>
      </div>
    </nz-modal>

    <!-- Modal Gán quyền -->
    <app-assign-permission-modal [visible]="isAssignVisible" [role]="selectedRole"
      [groupedPermissions]="groupedPermissions" (cancelModal)="handleAssignCancel()"
      (save)="handleAssignOk($event)"></app-assign-permission-modal>

    <!-- Footer Modal -->
    <ng-template #createFooter>
      <app-button nz-button type="cancel" (click)="handleCreateCancel()" style="margin-right: 8px;">Hủy</app-button>
      <app-button nz-button type="primary" (click)="handleCreateOk()" [isLoading]="isConfirmLoading"
        [disabled]="!roleName || roleNameExists">
        Lưu
      </app-button>
    </ng-template>
  </div>

  <!-- Search box -->
  <div class="roles-search">
    <input nz-input placeholder="Tìm kiếm tên vai trò" [(ngModel)]="searchQuery" />
    <app-button class="search-button" nz-button type="primary" size="large" (click)="filterRoles()">Tìm kiếm</app-button>
  </div>

  <!-- Table roles -->
  <nz-table #table [nzData]="roles" [nzFrontPagination]="false" ngClass="custom-table">

    <thead>
      <tr>
        <th nzWidth="15%" scope="col">Hành động</th>
        <th nzWidth="60%" scope="col" nzShowSort [nzSortFn]="sortByName" nzSortKey="name">
          Tên vai trò
        </th>
        <th nzWidth="25%" scope="col" nzShowSort [nzSortFn]="sortByUserCount" nzSortKey="userCount">
          Số người dùng
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let role of table.data">
        <td>
          <app-action-dropdown [actions]="[
    { label: 'Gán quyền', icon: 'key', emitName: 'assign', disabled: role.name === 'Admin' },
    { label: 'Sửa', icon: 'edit', emitName: 'edit', disabled: role.name === 'Admin' },
    { label: 'Xóa', icon: 'delete', type: 'danger', emitName: 'delete', disabled: role.name === 'Admin' }
  ]" [data]="role" (action)="onDropdownAction($event)"></app-action-dropdown>

        </td>
        <td>{{ role.name }}</td>
        <td>{{ role.userCount }}</td>
      </tr>
    </tbody>
  </nz-table>

  <app-confirm-dialog [(isVisible)]="isDeleteModalVisible" title="Xóa vai trò"
    message="Bạn chắc chắn muốn xóa vai trò này?" confirmText="Xóa" cancelText="Hủy" confirmType="danger"
    (confirm)="handleConfirmDelete()" (cancelModal)="handleCancelDelete()"></app-confirm-dialog>


  <!-- Pagination -->
  <app-pagination [total]="totalItems" [pageSize]="pageSize" [pageIndex]="currentPage"
    (pageChange)="onPageChange($event)" (pageSizeChange)="onPageSizeChange($event)"></app-pagination>
</div>